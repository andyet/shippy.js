(function(){function t(){this.callbacks={}}var e=this,n=Array.prototype.slice,a=function(t){return"[object Function]"==Object.prototype.toString.call(t)},s=function(t,e){for(var n in e)t[n]=e[n]};e.io||(e.io=require("socket.io-client")),t.prototype.on=function(t){var e=3===arguments.length,n=e?arguments[1]:void 0,a=e?arguments[2]:arguments[1];return a._groupName=n,(this.callbacks[t]=this.callbacks[t]||[]).push(a),this},t.prototype.once=function(t){function e(){n.off(t,e),i.apply(this,arguments)}var n=this,a=3===arguments.length,s=a?arguments[1]:void 0,i=a?arguments[2]:arguments[1];return this.on(t,s,e),this},t.prototype.releaseGroup=function(t){var e,n,a,s;for(e in this.callbacks)for(s=this.callbacks[e],n=0,a=s.length;a>n;n++)s[n]._groupName===t&&(s.splice(n,1),n--,a--);return this},t.prototype.off=function(t,e){var n,a=this.callbacks[t];return a?1===arguments.length?(delete this.callbacks[t],this):(n=a.indexOf(e),a.splice(n,1),this):this},t.prototype.emit=function(t){var e,n,a=[].slice.call(arguments,1),s=this.callbacks[t],i=this.getWildcardCallbacks(t);if(s)for(e=0,n=s.length;n>e&&s[e];++e)s[e].apply(this,a);if(i)for(e=0,n=i.length;n>e&&i[e];++e)i[e].apply(this,[t].concat(a));return this},t.prototype.getWildcardCallbacks=function(t){var e,n,a=[];for(e in this.callbacks)n=e.split("*"),("*"===e||2===n.length&&t.slice(0,n[1].length)===n[1])&&(a=a.concat(this.callbacks[e]));return a};var i=function(e){var n=this.config={url:"https://api.andbang.com:443",transports:["websocket","flashsocket","htmlfile","xhr-multipart","xhr-polling","jsonp-polling"],reconnectAttempts:20,autoConnect:!0,autoSubscribe:!0};s(n,e),t.call(this),n.token&&n.autoConnect&&this.validateToken(n.token)};i.prototype=new t,i.prototype.validateToken=function(t,e){var n=this,a=arguments,s=e||function(){};this.connected?this.socket.emit("validateSession",t,function(t,e){e?(n.config.autoSubscribe&&n.socket.emit("subscribeTeams"),n.emit("ready",e),s(null,!0)):(n.emit("loginFailed"),s("Could not log in with token"))}):this.connect(function(){n.validateToken.apply(n,a)})},i.prototype.connect=function(t){var n=this,a=["editMember","online","offline","clearNotifications","editTeam","editTask","assignTask","deleteTask","shipTask","unshipTask","watchTask","unwatchTask","laterTask","unlaterTask","startTask","stopTask","sortTask","newTask","interaction","setLastReadNotification","setLastReadTeamChat","setLastReadDirectChat","setDirectChatState","resetLastInteraction","removeMember","notification","addMember","deleteInvite","chat","directChat"],s=0,i=a.length;for(this.socket=e.io.connect(this.config.url,{"max reconnection attempts":this.config.reconnectAttempts,transports:this.config.transports,"force new connection":!0}),this.socket.on("connect",function(){n.connected=!0,n.emit("connected"),t&&t()}),this.socket.on("disconnect",function(){n.connected=!1,n.emit("disconnected")}),this.socket.on("reconnect",function(){n.lastEvent&&setTimeout(function(){n.socket.emit("getEventsSinceId",n.lastEvent,function(t,e){t?(n.emit("staleReconnect"),n.disconnect()):e.forEach(function(t){n.emit(t.channel,t)})})},0)}),this.socket.on("error",function(t){"handshake unauthorized"===t&&n.emit("connectFail"),n.emit("error",t)});i>s;s++)this.socket.on(a[s],function(t){return function(e){e.eventNumber&&(n.lastEvent=e.eventNumber),n.emit(t,e)}}(a[s]))},i.prototype._callApi=function(t,e,s,i){var o=n.call(e),c=o[o.length-1],r=a(c)?c:null,p=r?n.call(o,0,o.length-1):o;i&&p.length!=s&&p.push({});var l=function(t,e,n){r&&("string"==typeof e?r(t,JSON.parse(e),n):r(t,e,n))};p.length?this.socket.emit(t,p,l):this.socket.emit(t,l)},i.prototype.disconnect=function(){this.socket.disconnect()},i.prototype.getMe=function(){this._callApi("getMe",arguments,0,!1)},i.prototype.updateMe=function(){this._callApi("updateMe",arguments,1,!1)},i.prototype.goOnline=function(){this._callApi("goOnline",arguments,0,!1)},i.prototype.goOffline=function(){this._callApi("goOffline",arguments,0,!1)},i.prototype.getMyTeams=function(){this._callApi("getMyTeams",arguments,0,!1)},i.prototype.getAllMyTeamData=function(){this._callApi("getAllMyTeamData",arguments,0,!1)},i.prototype.getMyNotifications=function(){this._callApi("getMyNotifications",arguments,1,!1)},i.prototype.clearMyNotifications=function(){this._callApi("clearMyNotifications",arguments,1,!1)},i.prototype.getTask=function(){this._callApi("getTask",arguments,2,!1)},i.prototype.updateTask=function(){this._callApi("updateTask",arguments,3,!1)},i.prototype.assignTask=function(){this._callApi("assignTask",arguments,3,!1)},i.prototype.deleteTask=function(){this._callApi("deleteTask",arguments,2,!1)},i.prototype.shipTask=function(){this._callApi("shipTask",arguments,2,!1)},i.prototype.unshipTask=function(){this._callApi("unshipTask",arguments,2,!1)},i.prototype.watchTask=function(){this._callApi("watchTask",arguments,2,!1)},i.prototype.unwatchTask=function(){this._callApi("unwatchTask",arguments,2,!1)},i.prototype.laterTask=function(){this._callApi("laterTask",arguments,2,!1)},i.prototype.unlaterTask=function(){this._callApi("unlaterTask",arguments,2,!1)},i.prototype.startTask=function(){this._callApi("startTask",arguments,2,!1)},i.prototype.stopTask=function(){this._callApi("stopTask",arguments,2,!1)},i.prototype.setTaskPosition=function(){this._callApi("setTaskPosition",arguments,3,!1)},i.prototype.createTaskForMe=function(){this._callApi("createTaskForMe",arguments,2,!1)},i.prototype.createTaskForTeammate=function(){this._callApi("createTaskForTeammate",arguments,3,!1)},i.prototype.getAllTasks=function(){this._callApi("getAllTasks",arguments,1,!1)},i.prototype.getTeamShippedTasks=function(){this._callApi("getTeamShippedTasks",arguments,1,!1)},i.prototype.getMemberTasks=function(){this._callApi("getMemberTasks",arguments,2,!1)},i.prototype.getMemberLateredTasks=function(){this._callApi("getMemberLateredTasks",arguments,2,!1)},i.prototype.getMemberShippedTasks=function(){this._callApi("getMemberShippedTasks",arguments,3,!0)},i.prototype.getMemberWatchedTasks=function(){this._callApi("getMemberWatchedTasks",arguments,2,!1)},i.prototype.getMemberActiveTask=function(){this._callApi("getMemberActiveTask",arguments,2,!1)},i.prototype.getMyTasks=function(){this._callApi("getMyTasks",arguments,1,!1)},i.prototype.getMyLateredTasks=function(){this._callApi("getMyLateredTasks",arguments,1,!1)},i.prototype.getMyShippedTasks=function(){this._callApi("getMyShippedTasks",arguments,2,!0)},i.prototype.getMyWatchedTasks=function(){this._callApi("getMyWatchedTasks",arguments,1,!1)},i.prototype.getMyActiveTask=function(){this._callApi("getMyActiveTask",arguments,1,!1)},i.prototype.getTeamActiveTasks=function(){this._callApi("getTeamActiveTasks",arguments,1,!1)},i.prototype.getMember=function(){this._callApi("getMember",arguments,2,!1)},i.prototype.getMembers=function(){this._callApi("getMembers",arguments,1,!1)},i.prototype.setLastReadNotification=function(){this._callApi("setLastReadNotification",arguments,2,!1)},i.prototype.setLastReadTeamChat=function(){this._callApi("setLastReadTeamChat",arguments,2,!1)},i.prototype.setLastReadDirectChat=function(){this._callApi("setLastReadDirectChat",arguments,3,!1)},i.prototype.setDirectChatState=function(){this._callApi("setDirectChatState",arguments,3,!1)},i.prototype.resetLastInteraction=function(){this._callApi("resetLastInteraction",arguments,2,!1)},i.prototype.getInvite=function(){this._callApi("getInvite",arguments,2,!1)},i.prototype.getInvites=function(){this._callApi("getInvites",arguments,1,!1)},i.prototype.sendChat=function(){this._callApi("sendChat",arguments,2,!1)},i.prototype.sendDirectChat=function(){this._callApi("sendDirectChat",arguments,3,!1)},i.prototype.getChatHistory=function(){this._callApi("getChatHistory",arguments,2,!0)},i.prototype.getDirectChatHistory=function(){this._callApi("getDirectChatHistory",arguments,3,!0)},"undefined"!=typeof exports?module.exports=i:e.Shippy=i}).call(this);